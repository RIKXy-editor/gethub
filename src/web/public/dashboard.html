<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Editors Club Dashboard</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <div class="dashboard">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>Editors Club</h2>
        <p>Dashboard</p>
      </div>
      <nav class="sidebar-nav">
        <a href="#" data-section="overview" class="active"><span>Overview</span></a>
        <a href="#" data-section="panels"><span>Ticket Panels</span></a>
        <a href="#" data-section="plans"><span>Plans</span></a>
        <a href="#" data-section="payments"><span>Payment Methods</span></a>
        <a href="#" data-section="subscriptions"><span>Subscriptions</span></a>
        <a href="#" data-section="tickets"><span>Tickets</span></a>
        <a href="#" data-section="reminders"><span>Reminders</span></a>
        <a href="#" data-section="settings"><span>Settings</span></a>
        <a href="#" data-section="logs"><span>Logs</span></a>
      </nav>
      <div class="sidebar-user" id="userInfo"></div>
    </aside>

    <main class="main-content">
      <section id="sec-overview" class="section active">
        <div class="page-header"><h1>Overview</h1></div>
        <div class="stats-grid" id="overviewStats"></div>
        <div class="card">
          <div class="card-header"><h3>Plan Popularity</h3></div>
          <table><thead><tr><th>Plan</th><th>Subscriptions</th><th>Revenue</th></tr></thead><tbody id="planStatsBody"></tbody></table>
        </div>
        <div class="card">
          <div class="card-header"><h3>Expiring Soon (7 days)</h3></div>
          <table><thead><tr><th>User</th><th>Plan</th><th>End Date</th><th>Actions</th></tr></thead><tbody id="expiringBody"></tbody></table>
        </div>
      </section>

      <section id="sec-panels" class="section">
        <div class="page-header"><h1>Ticket Panels</h1><button class="btn btn-primary" onclick="showPanelModal()">Create Panel</button></div>
        <div class="card"><table><thead><tr><th>Title</th><th>Channel</th><th>Status</th><th>Actions</th></tr></thead><tbody id="panelsBody"></tbody></table></div>
      </section>

      <section id="sec-plans" class="section">
        <div class="page-header"><h1>Subscription Plans</h1><button class="btn btn-primary" onclick="showPlanModal()">Add Plan</button></div>
        <div class="card"><table><thead><tr><th>Name</th><th>Duration</th><th>Price</th><th>Discount</th><th>Recommended</th><th>Enabled</th><th>Actions</th></tr></thead><tbody id="plansBody"></tbody></table></div>
      </section>

      <section id="sec-payments" class="section">
        <div class="page-header"><h1>Payment Methods</h1><button class="btn btn-primary" onclick="showPaymentModal()">Add Method</button></div>
        <div class="card"><table><thead><tr><th>Label</th><th>Emoji</th><th>Recommended</th><th>Enabled</th><th>Actions</th></tr></thead><tbody id="paymentsBody"></tbody></table></div>
      </section>

      <section id="sec-subscriptions" class="section">
        <div class="page-header">
          <h1>Subscriptions</h1>
          <div style="display:flex;gap:8px">
            <select id="subFilter" onchange="loadSubscriptions()"><option value="">All</option><option value="active">Active</option><option value="expired">Expired</option><option value="cancelled">Cancelled</option></select>
            <a href="/api/subscriptions/export" class="btn btn-outline btn-sm">Export CSV</a>
          </div>
        </div>
        <div class="card"><table><thead><tr><th>User</th><th>Email</th><th>Plan</th><th>Price</th><th>Start</th><th>End</th><th>Status</th><th>Actions</th></tr></thead><tbody id="subsBody"></tbody></table></div>
      </section>

      <section id="sec-tickets" class="section">
        <div class="page-header">
          <h1>Tickets</h1>
          <select id="ticketFilter" onchange="loadTickets()"><option value="">All</option><option value="open">Open</option><option value="closed">Closed</option></select>
        </div>
        <div class="card"><table><thead><tr><th>ID</th><th>User</th><th>Status</th><th>Plan</th><th>Payment</th><th>Created</th></tr></thead><tbody id="ticketsBody"></tbody></table></div>
      </section>

      <section id="sec-reminders" class="section">
        <div class="page-header"><h1>Reminder History</h1></div>
        <div class="card"><table><thead><tr><th>User</th><th>Date</th><th>Days Before</th><th>Sent</th><th>Sent At</th></tr></thead><tbody id="remindersBody"></tbody></table></div>
      </section>

      <section id="sec-settings" class="section">
        <div class="page-header"><h1>Settings</h1></div>
        <div class="card">
          <h3 style="margin-bottom:16px">Guild Settings</h3>
          <div class="form-group">
            <label>Staff Roles (for ticket management)</label>
            <div id="staffRolesContainer"></div>
          </div>
          <div class="form-group">
            <label>Reminder Days Before Expiry (comma-separated)</label>
            <input type="text" id="settReminderDays" placeholder="3,2,1">
          </div>
          <div class="form-group">
            <label>Default Ticket Category</label>
            <select id="settCategory"><option value="">None</option></select>
          </div>
          <div class="form-group">
            <label>Ticket Logs Channel</label>
            <select id="settLogsChannel"><option value="">None</option></select>
          </div>
          <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
        </div>
      </section>

      <section id="sec-logs" class="section">
        <div class="page-header"><h1>Activity Logs</h1></div>
        <div class="card"><table><thead><tr><th>Action</th><th>Actor</th><th>Target</th><th>Details</th><th>Time</th></tr></thead><tbody id="logsBody"></tbody></table></div>
      </section>
    </main>
  </div>

  <div class="modal-overlay" id="modalOverlay">
    <div class="modal" id="modalContent"></div>
  </div>

  <script src="/js/dashboard.js"></script>
</body>
</html>
