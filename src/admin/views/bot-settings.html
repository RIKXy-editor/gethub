<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bot Settings - Admin</title>
  <link rel="stylesheet" href="/admin/css/style.css">
  <style>
    .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
    @media (max-width: 900px) { .settings-grid { grid-template-columns: 1fr; } }
    .form-section { padding: 20px; background: var(--card-bg); border-radius: 8px; border: 1px solid var(--border-color); margin-bottom: 20px; }
    .form-section h4 { margin: 0 0 16px; color: var(--accent-color); font-size: 14px; text-transform: uppercase; }
    .form-group { margin-bottom: 16px; }
    .form-group label { display: block; margin-bottom: 6px; color: var(--text-secondary); font-size: 13px; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 6px; color: var(--text-primary); }
    .status-list { margin-top: 12px; }
    .status-item { display: flex; align-items: center; gap: 8px; padding: 8px 12px; background: var(--bg-secondary); border-radius: 6px; margin-bottom: 8px; }
    .status-item span { flex: 1; }
    .status-item button { background: none; border: none; color: #ff6b6b; cursor: pointer; font-size: 16px; }
    .add-status { display: flex; gap: 8px; margin-top: 12px; }
    .add-status input { flex: 1; }
  </style>
</head>
<body>
  <aside class="sidebar">
    <div class="sidebar-header"><h1>Editors Club Official</h1></div>
    <ul class="sidebar-nav">
      <li><a href="/admin"><span class="icon">ğŸ“Š</span> Dashboard</a></li>
      <li><a href="/admin/tickets"><span class="icon">ğŸ«</span> Tickets</a></li>
      <li><a href="/admin/panels"><span class="icon">ğŸ“‹</span> Panels</a></li>
      <li><a href="/admin/embed-builder"><span class="icon">ğŸ¨</span> Embed Builder</a></li>
      <li><a href="/admin/welcome"><span class="icon">ğŸ‘‹</span> Welcome</a></li>
      <li><a href="/admin/keywords"><span class="icon">ğŸ”‘</span> Keywords</a></li>
      <li><a href="/admin/giveaways"><span class="icon">ğŸ</span> Giveaways</a></li>
      <li><a href="/admin/announcements"><span class="icon">ğŸ“¢</span> Announcements</a></li>
      <li><a href="/admin/scheduled"><span class="icon">â°</span> Scheduled</a></li>
      <li><a href="/admin/sticky"><span class="icon">ğŸ“Œ</span> Sticky</a></li>
      <li><a href="/admin/sticky-clients"><span class="icon">ğŸ‘¥</span> Client Finder</a></li>
      <li><a href="/admin/dm-sender"><span class="icon">âœ‰ï¸</span> DM Sender</a></li>
      <li><a href="/admin/job-config"><span class="icon">ğŸ’¼</span> Job Config</a></li>
      <li><a href="/admin/bot-settings" class="active"><span class="icon">ğŸ¤–</span> Bot Settings</a></li>
      <li><a href="/admin/settings"><span class="icon">âš™ï¸</span> Settings</a></li>
      <li><a href="/admin/logout"><span class="icon">ğŸšª</span> Logout</a></li>
    </ul>
  </aside>

  <main class="main-content">
    <div class="page-header">
      <h2>Bot Settings</h2>
      <p>Configure bot status and rotating messages</p>
    </div>

    <div class="settings-grid">
      <div class="form-section">
        <h4>Status Messages</h4>
        <p style="color:var(--text-secondary);font-size:13px;margin-bottom:12px;">Add messages that rotate in the bot's status</p>
        
        <div class="form-group">
          <label>Activity Type</label>
          <select id="activityType">
            <option value="Playing">Playing</option>
            <option value="Watching">Watching</option>
            <option value="Listening">Listening to</option>
            <option value="Competing">Competing in</option>
          </select>
        </div>
        
        <div class="status-list" id="statusList"></div>
        
        <div class="add-status">
          <input type="text" id="newStatus" placeholder="New status message...">
          <button class="btn btn-secondary" onclick="addStatus()">Add</button>
        </div>
      </div>

      <div class="form-section">
        <h4>Preview</h4>
        <div style="background:#2f3136;border-radius:8px;padding:16px;">
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="width:40px;height:40px;background:#5865f2;border-radius:50%;display:flex;align-items:center;justify-content:center;">ğŸ¤–</div>
            <div>
              <div style="font-weight:600;color:white;">Editors Club Bot</div>
              <div style="font-size:12px;color:#72767d;" id="previewStatus">Playing with tickets</div>
            </div>
          </div>
        </div>
        
        <p style="color:var(--text-secondary);font-size:12px;margin-top:12px;">Status messages rotate every 30 seconds</p>
      </div>
    </div>

    <button class="btn btn-primary" onclick="saveSettings()" style="width:100%;max-width:400px;">Save Settings</button>
  </main>

  <script src="/admin/js/unsaved.js"></script>
  <script>
    let statusMessages = [];

    async function loadSettings() {
      const res = await fetch('/admin/api/bot-settings');
      const settings = await res.json();
      statusMessages = settings.statusMessages || [];
      document.getElementById('activityType').value = settings.activityType || 'Playing';
      renderStatusList();
      updatePreview();
      setTimeout(() => UnsavedChanges.refresh && UnsavedChanges.refresh(), 100);
    }

    function renderStatusList() {
      const container = document.getElementById('statusList');
      if (statusMessages.length === 0) {
        container.innerHTML = '<p style="color:var(--text-secondary);font-size:13px;">No status messages added</p>';
        return;
      }
      container.innerHTML = statusMessages.map((s, i) => `
        <div class="status-item">
          <span>${s}</span>
          <button onclick="removeStatus(${i})">&times;</button>
        </div>
      `).join('');
    }

    function addStatus() {
      const input = document.getElementById('newStatus');
      const status = input.value.trim();
      if (!status) return;
      statusMessages.push(status);
      input.value = '';
      renderStatusList();
      updatePreview();
    }

    function removeStatus(index) {
      statusMessages.splice(index, 1);
      renderStatusList();
      updatePreview();
    }

    function updatePreview() {
      const type = document.getElementById('activityType').value;
      const status = statusMessages[0] || 'with tickets';
      document.getElementById('previewStatus').textContent = `${type} ${status}`;
    }

    async function saveSettings() {
      const res = await fetch('/admin/api/bot-settings', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          statusMessages,
          activityType: document.getElementById('activityType').value
        })
      });
      if (res.ok) {
        alert('Settings saved! Bot status will update shortly.');
        UnsavedChanges.markSaved();
      } else {
        alert('Failed to save settings');
      }
    }

    document.getElementById('activityType').addEventListener('change', updatePreview);
    document.getElementById('newStatus').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addStatus();
    });

    UnsavedChanges.init(saveSettings);
    loadSettings();
  </script>
</body>
</html>
